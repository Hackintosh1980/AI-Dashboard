Alles klar â€” jetzt dokumentieren wir das Setup-Modul, also den Screen, der die komplette Multi-Device-Konfiguration & ZOMBIE-Handling bereitstellt.

Das ist ein absolut zentrales StÃ¼ck deiner Architektur, weil:

Hier entscheidet der User, welche GerÃ¤te aktiv sind

Hier wird das Profil pro MAC gesetzt

Hier entsteht deine â€Living Sensor Worldâ€œ

Setup bestimmt, welche GerÃ¤te Ã¼berhaupt im Watchdog + Decoder existieren

Setup bildet den Lebenszyklus eines GerÃ¤ts ab:

Living

Zombie

Offline




---

ğŸ“˜ SETUP-SCREEN â€“ Ãœberblick

ğŸ¯ Hauptaufgabe

Der SetupScreen erlaubt dir:

GerÃ¤te aus deiner Multi-Device-Liste zu verwalten

MAC-Adressen hinzuzufÃ¼gen oder zu lÃ¶schen

PRO Profile pro GerÃ¤t zu wÃ¤hlen (tb2 / tpro / oqimax / unknown / â€¦)

ZOMBIES zu identifizieren, also GerÃ¤te die zwar im Dump sind, aber keine RAW-Ã„nderung zeigen

mit einem Klick zwischen â€Livingâ€œ und â€Zombieâ€œ zu unterscheiden

die Config sauber zu speichern


Er ist der Administrator-Modus deines Systems.


---

ğŸŒ‹ Was sind Zombies?

Zombies sind GerÃ¤te im BLE-Dump, die:

1. zwar gefunden werden


2. aber keine RAW-Ã„nderung mehr zeigen


3. und deren last_raw == aktuelles RAW bleibt


4. deren last_ts Ã¼ber stale_timeout hinaus geht



Sie leben BLE-technisch, aber sie senden keine neuen Messwerte â†’ klassische Firmware-HÃ¤nger.

Setup markiert solche GerÃ¤te visuell:

âšª Living â†’ aktive RAW-Ã„nderungen

ğŸŸ¡ Zombie â†’ RAW unverÃ¤ndert, aber sichtbar

ğŸ”´ Offline â†’ nicht im Dump


Das ist einer der grÃ¶ÃŸten Vorteile deiner Architektur:
Du erkennst nicht nur OFFLINE, sondern ZOMBIE-ZustÃ¤nde.


---

ğŸ“˜ UI / Bedienlogik im Setup

âœ” 1) GerÃ¤teliste

Setup zeigt eine tabellarische Ansicht:

MAC-Adresse

Profil-Auswahl

aktueller Status (Living / Zombie / Offline)

LÃ¶schen-Button


Datenquelle ist ausschlieÃŸlich:

config.get_all_devices()

Setup zeigt also NICHT alle gefundenen GerÃ¤te in der Umgebung â€”
nur die, die der User explizit konfiguriert hat.


---

âœ” 2) Profilauswahl

Jede Zeile hat ein Dropdown:

tb2

tpro

oqimax

unknown

â€¦


Wenn geÃ¤ndert, wird sofort im RAM gesetzt â€” erst Save schreibt in config.json.


---

âœ” 3) Zombie-Erkennung in Setup

Setup selbst entscheidet nicht, ob ein GerÃ¤t Zombie ist.
Es liest den Watchdog:

watchdog_status = GLOBAL_STATE.last_watchdog_status

Dann zeigt es pro MAC:

status="OK"   â†’ Living

status="STALE" â†’ Zombie

status="OFFLINE" â†’ Tot


Setup ist also passiv, rein UI â€” die Intelligenz kommt vom Watchdog.


---

âœ” 4) GerÃ¤te hinzufÃ¼gen

Ein Feld + Button:

MAC eingeben

Profil wÃ¤hlen

GerÃ¤t erscheint in der Liste



---

âœ” 5) GerÃ¤te entfernen

LÃ¶schen entfernt den Eintrag aus config.devices.
Decoder Ã¼berschreibt sofort decoded.json â†’ OFFLINE.
Dashboard zeigt sofort OFFLINE / leer.


---

âœ” 6) Speichern

Der â€SAVEâ€œ-Button tut exakt das:

1. cfg = config._init()


2. alle geÃ¤nderten Werte in cfg["devices"] schreiben


3. config.save(cfg) (atomar)


4. config.reload()


5. Watchdog-Timeout Ã¼bernehmen


6. zurÃ¼ck ins Dashboard



Wichtig:
Setup speichert NIE Statisches Ã¼ber RAW oder last_seen.
Das ist Aufgabe des Watchdogs.


---

ğŸ§  Warum ist Setup so wichtig fÃ¼r Zombies?

Weil das gesamte ZOMBIE-Konzept so funktioniert:

1ï¸âƒ£ Setup definiert die Targets:

Nur GerÃ¤te in config["devices"] sind wichtig.

2ï¸âƒ£ Watchdog Ã¼berwacht NUR diese GerÃ¤te.

Er entscheidet: Living / Zombie / Offline.

3ï¸âƒ£ Decoder schreibt Frames abhÃ¤ngig vom Watchdog.

Damit Dashboard und Grafiken korrekt sind.

4ï¸âƒ£ Setup zeigt den Status visuell.

Damit du in Echtzeit erkennst:

ob ein GerÃ¤t richtig sendet

ob es abgestÃ¼rzt ist (Zombie)

ob es komplett weg ist (Offline)



---

ğŸ“¦ Wichtigster Punkt fÃ¼r Dokumentation

> Der gesamte ZOMBIE-Lebenszyklus entsteht aus dem Zusammenspiel Setup â†’ Watchdog â†’ Decoder â†’ Dashboard.



Setup ist der Startpunkt:
Es definiert, welche GerÃ¤te Ã¼berhaupt leben dÃ¼rfen.

Watchdog bestimmt, ob sie wirklich leben.

Decoder erschafft die Frames, die der UI sagen, wie sie aussehen.

Dashboard visualisiert, wie es den GerÃ¤ten geht.


---

ğŸ“˜ Bereit fÃ¼r Dashboard?

Wenn du magst, machen wir jetzt:

âœ DashboardScreen â€“ Die Lebensanzeige

incl.

GSM

Tiles

Fullscreen

Control Buttons

LED Logik

Statusmapping OK / STALE / OFFLINE


Sag einfach: â€Dashboard jetztâ€œ.