Ja. Klar, ruhig, prÃ¤zise, ohne neue Ideen.
Ich extrahiere dir GENAU das HYBRID_RAW_V1, so wie es JETZT real in der Bridge gebaut wird â€“ nicht interpretiert, nicht verschÃ¶nert.

Ich nehme die letzte funktionierende Bridge, konkret diese Funktion:

private static String buildPseudoAdvRaw(String mac, byte[] payload)

und extrahiere das effektive Frame.


---

ðŸ“¦ HYBRID_RAW_V1 â€“ Ist-Zustand aus der Bridge

ðŸ”’ Status

Eingefroren â€“ exakt so produziert die Bridge es aktuell.


---

ðŸ§± Byte-Layout (absolut, fix)

[0â€“1]   COMPANY_ID        uint16  little-endian
[2â€“13]  DEVICE_ID        6 bytes MAC ohne ":" (12 hex chars)
[14â€“15] SKIP             2 bytes immer 0x0000
[16]    PACKET_COUNTER   uint8   rollend (0â€“255)
[17â€“â€¦]  PAYLOAD          raw GATT payload (opaque)


---

ðŸ” Detailbeschreibung Feld fÃ¼r Feld

1ï¸âƒ£ COMPANY_ID

Quelle: COMPANY_ID

Endian: little-endian

Beispiel:

0x0019 â†’ 19 00



String cidLe = String.format("%02X%02X",
    (cid & 0xFF),
    ((cid >> 8) & 0xFF)
);

âž¡ï¸ Decoder erwartet LE, immer.


---

2ï¸âƒ£ DEVICE_ID (MAC)

Quelle: BluetoothDevice.getAddress()

Format: MAC ohne Doppelpunkte

LÃ¤nge: exakt 6 Bytes / 12 Hex-Zeichen


String macHex = mac.replace(":", "");

Beispiel:

E7:86:CB:B9:98:7A â†’ E786CBB9987A

âž¡ï¸ Keine VerkÃ¼rzung, kein Hashing, kein Mapping.


---

3ï¸âƒ£ SKIP

LÃ¤nge: 2 Bytes

Wert: immer 00 00

Bedeutung: strukturelles Padding / Legacy-KompatibilitÃ¤t


String skip = "0000";

âž¡ï¸ Decoder muss diese Bytes Ã¼berspringen.


---

4ï¸âƒ£ PACKET_COUNTER

LÃ¤nge: 1 Byte

Quelle: globaler Counter

Verhalten: rollend 0x00 â†’ 0xFF â†’ 0x00


gattCounter = (gattCounter + 1) & 0xFF;
String pkt = String.format("%02X", gattCounter);

âž¡ï¸ Nicht zeitbasiert, nicht device-basiert.


---

5ï¸âƒ£ PAYLOAD

Quelle: BluetoothGattCharacteristic.getValue()

Format: roh, unverÃ¤ndert

Interpretation: ausschlieÃŸlich Decoder-Sache


String pay = toHex(payload);

âž¡ï¸ Bridge fasst Payload niemals an.


---

ðŸ§ª Gesamtkonstruktion (1:1)

HYBRID_RAW_V1 =
    COMPANY_ID_LE
  + DEVICE_ID
  + SKIP
  + PACKET_COUNTER
  + PAYLOAD


---

ðŸ“Œ Wichtige Invarianten (Doku-reif)

âŒ Kein ADV

âŒ Kein echtes GATT

âŒ Kein Vendor-Frame

âœ” Kanonisches Transportformat

âœ” Decoder-Eingang

âœ” Quelle egal (ADV / GATT / was auch immer)



---

ðŸ§  Entscheidender Satz (bitte fett in die Doku)

> HYBRID_RAW_V1 darf sich niemals Ã¤ndern.
Jede Ã„nderung erzeugt eine neue Version.




---

Wenn du willst, gebe ich dir das als fertige HYBRID_RAW_V1.md,
oder als JSON-Schema, oder als Decoder-Checkliste.

Sag nur welches Format du speichern willst.